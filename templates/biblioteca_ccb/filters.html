{% extends "base.html" %}

{% block title %}Biblioteca Digital CCB - Filtros de Búsqueda{% endblock %}

{% block nav_links %}
<a href="{{ url_for('dashboard') }}" class="nav-link">
  <i class="fas fa-home"></i>
  Dashboard
</a>
<a href="#" class="nav-link active">
  <i class="fas fa-landmark"></i>
  Biblioteca CCB
</a>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/biblioteca_ccb.css') }}" />
{% endblock %}

{% block content %}
<div class="container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <i class="fas fa-landmark header-icon"></i>
      <div>
        <h1>Biblioteca Digital CCB</h1>
        <p>Cámara de Comercio de Bogotá - Sistema de Laudos Arbitrales</p>
      </div>
    </div>
  </div>

  <!-- Tipo de Arbitraje Selector -->
  <div class="card">
    <div class="card-header">
      <i class="fas fa-gavel"></i>
      <h3>Tipo de Arbitraje</h3>
    </div>
    <div class="arbitrage-selector">
      <div class="form-group">
        <label for="tipoArbitraje">Seleccione el tipo de arbitraje a consultar</label>
        <select id="tipoArbitraje" class="form-control" onchange="handleArbitrageTypeChange()">
          <option value="">-- Seleccione una opción --</option>
          <option value="nacional" selected>a. Arbitraje nacional</option>
          <option value="social" disabled>b. Arbitraje social (Próximamente)</option>
        </select>
        <div class="coming-soon-notice" id="socialNotice" style="display: none;">
          <i class="fas fa-clock"></i>
          <span>Esta funcionalidad estará disponible próximamente</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Filtros de Búsqueda -->
  <div class="card" id="filtersCard">
    <div class="card-header">
      <i class="fas fa-filter"></i>
      <h3>Filtros de Búsqueda - Arbitraje Nacional</h3>
    </div>

    <form id="searchForm" class="search-form">
      <!-- Tabs de filtros -->
      <div class="filter-tabs">
        <button type="button" class="tab-button active" onclick="setActiveTab(this, 'fecha')">
          Por fecha de publicación
        </button>
        <button type="button" class="tab-button" onclick="setActiveTab(this, 'autor')">
          Por autor
        </button>
        <button type="button" class="tab-button" onclick="setActiveTab(this, 'titulo')">
          Por título
        </button>
        <button type="button" class="tab-button" onclick="setActiveTab(this, 'materia')">
          Por materia
        </button>
      </div>

      <!-- Contenido de las pestañas -->
      <div class="tab-content">
        <!-- Por fecha (predeterminado) -->
        <div id="tab-fecha" class="tab-pane active">
          <div class="form-row date-filters">
            <div class="form-group">
              <label for="yearFilter">Año</label>
              <select id="yearFilter" class="form-control" onchange="handleYearChange()">
                <option value="">Todos los años</option>
                <!-- Se llenarán dinámicamente -->
              </select>
              <small class="form-text">Seleccione el año de publicación</small>
            </div>
            <div class="form-group">
              <label for="monthFilter">Mes</label>
              <select id="monthFilter" class="form-control" disabled>
                <option value="">Todos los meses</option>
                <option value="01">Enero</option>
                <option value="02">Febrero</option>
                <option value="03">Marzo</option>
                <option value="04">Abril</option>
                <option value="05">Mayo</option>
                <option value="06">Junio</option>
                <option value="07">Julio</option>
                <option value="08">Agosto</option>
                <option value="09">Septiembre</option>
                <option value="10">Octubre</option>
                <option value="11">Noviembre</option>
                <option value="12">Diciembre</option>
              </select>
              <small class="form-text">Primero seleccione un año</small>
            </div>
          </div>
          <div class="info-message">
            <i class="fas fa-info-circle"></i>
            <p>Puede buscar por año específico o filtrar por año y mes. Si no selecciona ningún filtro, se descargarán todos los documentos disponibles.</p>
          </div>
        </div>

        <!-- Por autor -->

        <div id="tab-autor" class="tab-pane">
            <div class="form-group">
                <label for="autor">
                    <i class="fas fa-user"></i>
                    Nombre del autor o árbitro
                </label>
                <input
                    type="text"
                    id="autor"
                    name="autor"
                    class="form-control"
                    placeholder="Ej: Abela Maldonado, Andrew"
                    list="autorList"
                    autocomplete="off"
                />
                <datalist id="autorList"></datalist>
                <small class="form-text">
                    Ingrese el nombre completo o parcial del autor/árbitro
                </small>
            </div>

            <div class="info-message">
                <i class="fas fa-info-circle"></i>
                <div>
                    <p><strong>Búsqueda por autor:</strong></p>
                    <ul style="margin: 0.5rem 0 0 1rem; padding: 0; list-style-position: inside;">
                        <li>Escriba al menos 2 caracteres para ver sugerencias</li>
                        <li>El sistema mostrará autores que coincidan con su búsqueda</li>
                        <li>Cada autor muestra la cantidad de documentos disponibles</li>
                        <li>Se descargarán todos los laudos del autor seleccionado</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Por título -->
        <div id="tab-titulo" class="tab-pane">
          <div class="form-group">
            <label for="titulo">Título del laudo</label>
            <input type="text" id="titulo" class="form-control" placeholder="Ingrese palabras clave del título" />
            <small class="form-text">Busque por palabras clave en el título del laudo arbitral</small>
          </div>
        </div>

        <!-- Por materia -->
        <div id="tab-materia" class="tab-pane">
            <div class="form-group">
                <label for="materia">
                    <i class="fas fa-tags"></i>
                    Materia o tema
                </label>
                <input
                    type="text"
                    id="materia"
                    name="materia"
                    class="form-control"
                    placeholder="Ej: Arbitraje comercial, Contratos, etc."
                    autocomplete="off"
                />
                <small class="form-text">
                    Ingrese la materia o tema de interés
                </small>
            </div>

            <div class="info-message">
                <i class="fas fa-info-circle"></i>
                <div>
                    <p><strong>Búsqueda por materia:</strong></p>
                    <ul style="margin: 0.5rem 0 0 1rem; padding: 0; list-style-position: inside;">
                        <li>Escriba el nombre completo o parcial de la materia</li>
                        <li>Si hay múltiples coincidencias, podrá seleccionar la correcta</li>
                        <li>Cada materia muestra la cantidad de documentos disponibles</li>
                        <li>Se descargarán todos los laudos de la materia seleccionada</li>
                    </ul>
                </div>
            </div>
        </div>
      </div>

      <!-- Botones de acción -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="resetForm()">
          <i class="fas fa-undo"></i>
          Limpiar filtros
        </button>
        <button type="submit" class="btn btn-primary" id="searchButton">
          <i class="fas fa-search"></i>
          Buscar laudos
        </button>
      </div>
    </form>
  </div>

  <!-- Panel de Resultados -->
  <div class="card" id="resultsPanel" style="display: none;">
    <div class="card-header">
      <i class="fas fa-chart-bar"></i>
      <h3>Resultados de la Búsqueda</h3>
    </div>

    <div class="results-content">
      <!-- Estado de búsqueda -->
      <div class="search-status" id="searchStatus">
        <div class="status-icon">
          <i class="fas fa-spinner fa-spin"></i>
        </div>
        <div class="status-text">
          <h4>Procesando búsqueda...</h4>
          <p>Por favor espere mientras se obtienen los documentos.</p>
        </div>
      </div>

      <!-- Estadísticas -->
      <div class="stats-grid" id="statsGrid" style="display: none;">
        <div class="stat-card">
          <div class="stat-value" id="expectedCount">0</div>
          <div class="stat-label">Documentos Esperados</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="processedCount">0</div>
          <div class="stat-label">Documentos Procesados</div>
        </div>
        <div class="stat-card success">
          <div class="stat-value" id="downloadedCount">0</div>
          <div class="stat-label">PDFs Descargados</div>
        </div>
        <div class="stat-card error">
          <div class="stat-value" id="failedCount">0</div>
          <div class="stat-label">Errores</div>
        </div>
      </div>

      <!-- Detalles adicionales -->
      <div class="result-details" id="resultDetails" style="display: none;">
        <div class="detail-row">
          <span class="detail-label">Duración:</span>
          <span class="detail-value" id="duration">-</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Tamaño total:</span>
          <span class="detail-value" id="totalSize">-</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Fecha:</span>
          <span class="detail-value" id="searchDate">-</span>
        </div>
      </div>

      <!-- Reporte final -->
      <div class="final-report" id="finalReport" style="display: none;">
        <h4><i class="fas fa-file-alt"></i> Reporte Final</h4>
        <div class="report-summary">
          <div class="summary-row">
            <span>Recolectados:</span>
            <span class="summary-value" id="summaryCollected">0</span>
          </div>
          <div class="summary-row">
            <span>Descargados:</span>
            <span class="summary-value success-text" id="summaryDownloaded">0</span>
          </div>
          <div class="summary-row">
            <span>Errores:</span>
            <span class="summary-value error-text" id="summaryErrors">0</span>
          </div>
          <div class="summary-row">
            <span>Tasa de éxito:</span>
            <span class="summary-value" id="successRate">0%</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Información adicional -->
  <div class="info-cards">
    <div class="info-card">
      <i class="fas fa-info-circle"></i>
      <h4>Sobre la Biblioteca Digital CCB</h4>
      <p>Acceda a la colección completa de laudos arbitrales de la Cámara de Comercio de Bogotá, incluyendo decisiones en arbitraje nacional y social.</p>
    </div>
    <div class="info-card">
      <i class="fas fa-shield-alt"></i>
      <h4>Información confiable</h4>
      <p>Todos los laudos son documentos oficiales publicados por el Centro de Arbitraje y Conciliación de la CCB.</p>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/biblioteca_ccb.js') }}"></script>
{% endblock %}